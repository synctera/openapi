components:
  schemas:
    paginated_response:
      title: Paginated List response
      type: object
      properties:
        next_page_token:
          type: string
          description: If returned, use the next_page_token to query for the next page of results. Not returned if there are no more rows.
          example: a8937a0d

    error:
      title: Standard error response (RFC 7807 problem report)
      description: >-
        Synctera error responses in API v0 follow [RFC 7807](https://datatracker.ietf.org/doc/html/rfc7807).
        Following that standard, the field for a machine-readable "error code" in API v0 is `type`.

        In our future API v1, we are phasing out RFC 7807 and adopting a custom error format.
        That format will be documented in our API v1 spec.
        But you may see some v0 error responses with a machine-readable `code` field
        while we are making the transition from v0 to v1.
      type: object
      # When all of our error responses use this format, then we can specify
      # the required fields here. Until then, it would just cause test failures
      # to do so, because legacy error responses do not fit this schema.
      properties:
        type:
          type: string
          description: >
            A machine-readable string that identifies the error for programmatic use.
            This is a URI, i.e. a globally unique identifier.
            It is _not_ necessarily a URL, so do not expect it to resolve to a web page.
            You can use this whole string as an error code, or just everything after the last slash.

            This field will be removed in API v1.
          example: "https://dev.synctera.com/errors/bad-request-body"
        status:
          type: integer
          description: the HTTP status code for this response
          example: 400
        title:
          type: string
          description: >
            A human-readable string for this general category of error, which corresponds
            1-to-1 with error types (`title` is the human-readable version of `type`).
            There can be multiple distinct titles for the same HTTP status code, and
            the same `title` can result in many different `detail` strings.

            This field will be removed in API v1.
          example: "Bad Request Body"
        detail:
          type: string
          description: >
            A human-readable string explaining this particular error.
          example: "missing required fields: first_name, dob"
        code:
          type: string
          description: >-
            An optional “sneak preview” of our future API v1 error responses.
            This is provided to give integrators a chance to work with our future error codes.
            Error codes for the same error may change between v0 and v1.
          example: BAD_REQUEST_BODY

    delete_response:
      title: Deleted Object
      type: object
      description: Deleted object information
      properties:
        id:
          type: string
          format: uuid
          description: Object ID
        resource:
          type: string
          description: The resource name

    vendor_info:
      title: Vendor Info
      type: object
      description: >
        The information provided to Synctera from the vendor.
        Interpretation of this object is up to the client.
      discriminator:
        propertyName: content_type
        mapping:
          "application/json": "#/components/schemas/vendor_json"
          "text/xml": "#/components/schemas/vendor_xml"
      oneOf:
        - $ref: "#/components/schemas/vendor_json"
        - $ref: "#/components/schemas/vendor_xml"

    vendor_json:
      properties:
        vendor:
          type: string
          example: SOCURE
        content_type:
          type: string
          description: Describes the content-type encoding received from the vendor
          enum:
            - "application/json"
        json:
          type: object
          description: Data representation in JSON
      required:
        - vendor
        - content_type
        - json

    vendor_xml:
      properties:
        vendor:
          type: string
          example: IDOLOGY
        content_type:
          type: string
          description: Describes the content-type encoding received from the vendor
          enum:
            - "text/xml"
        xml:
          type: string
          description: Data representaion in XML
      required:
        - vendor
        - content_type
        - xml

    metadata:
      description: >
        Optional field to store additional information about the resource.
        Intended to be used by the integrator to store non-sensitive data.
      type: object

    tenant:
      title: Tenant
      type: object
      properties:
        bank_id:
          description: Bank ID
          type: integer
          example: 6
        partner_id:
          description: Partner ID
          type: integer
          example: 6
      required:
        - bank_id
        - partner_id

    partner:
      title: Partner
      type: object
      properties:
        partner_country:
          description: The country for this partner, a 2 character ISO 3166 string
          type: string
          enum:
            - US
            - CA
      required:
        - partner_country

    tenant_id:
      description: |
        The id of the tenant containing the resource. This is relevant for Fintechs that have multiple workspaces.
      type: string
      example: "abcdef_ghijkl"

    tenant_id_internal:
      x-external: false
      description: |
        The id of the tenant containing the resource. Not included in external documentation.
      type: string
      example: "abcdef_ghijkl"

    workspace_resources_post:
      title: Request for creating workspace resources
      type: object
      properties:
        tenant:
          description: The tenant whose resources are being created as part of this quickstart request.
          allOf:
            - $ref: "#/components/schemas/tenant"
        parent_tenant:
          description: >
            If `tenant` is a fintech, this is the sponsor bank's self-partner tenant.
            If `tenant` is a bank, this is Synctera (1_1).
          allOf:
            - $ref: "#/components/schemas/tenant"
        bank_self_partner_tenant:
          description: >
            If `tenant` is a fintech, this is the sponsor bank's self-partner tenant.
            If `tenant` is a bank, this is the same as `tenant`.
          deprecated: true
          allOf:
            - $ref: "#/components/schemas/tenant"
        is_tminus10:
          description: |
            Flag which indicates if the workspace is a t-minus10 workspace.
            Some services may create different resources depending on this flag.
          type: boolean
        partner_type:
          $ref: "#/components/schemas/partner_type"
        partner:
          description: The partner object.
          allOf:
            - $ref: "#/components/schemas/partner"
      required:
        - tenant
        - is_tminus10
        - partner_type
        - partner

    sample_resources_post:
      title: Request for creating sample resources
      type: object
      properties:
        tenant:
          $ref: "#/components/schemas/tenant"
        partner:
          description: The partner object.
          allOf:
            - $ref: "#/components/schemas/partner"
      required:
        - tenant
        - partner

    workspace_wipe_post:
      title: Request for wiping a workspace
      type: object
      properties:
        tenant:
          $ref: "#/components/schemas/tenant"
      required:
        - tenant

    vendor_config_status:
      type: string
      description: Status of vendor configuration
      enum:
        - NOT_CONTRACTED
        - NOT_CONFIGURED
        - MISCONFIGURED
        - OK

    partner_type:
      type: string
      enum:
        - BANK_SELF_PARTNER
        - FINTECH
        - VENDOR
      description: |
        Type of partner. One of the following:
        * `BANK_SELF_PARTNER` - The partner aspect of a bank tenant.
        * `FINTECH` - A fintech partnered with a bank.
        * `VENDOR` - A vendor providing services to the Synctera platform.

    ## PUNCHOUT

    schedule_attempt_request:
      type: object
      required:
        - attempt_id
        - step_key
        - step_run_id
        - details
      properties:
        attempt_id:
          type: string
          format: uuid
          description: >
            The identifier for the run attempt.
        step_key:
          type: string
          description: >
            The machine-readable key for your step's work. This value should be known by your
            service already, and should indicate what kind of work you're being asked to do. This
            is helpful if your service is involved multiple times in schedules.
        step_run_id:
          type: string
          format: uuid
          description: >
            An identifier for the overall step run. You should keep this handy for when you're
            ready to finalise the attempt with Punchout.
        details:
          $ref: '#/components/schemas/schedule_attempt_request_details'

    schedule_attempt_request_details:
      type: object
      description: >
        The details of the overall step run. This should contain all the info you need to do
        your work.
      required:
        - schedule_trigger
        - schedule_state
        - step_settings
      properties:
        schedule_trigger:
          type: object
          format: rawjson
          description: >
            The original trigger for this run of the schedule. You can expect this to abide by the
            same schema from run to run.
          x-go-type: json.RawMessage
        schedule_state:
          type: object
          description: >
            A list of key-value pairs that indicate the state of the schedule as Punchout understands
            it. This is schedule-specific, and will likely list specific checkpoints that you can
            check against if you're expecting to run only after certain dependencies have been met.
        step_settings:
          $ref: '#/components/schemas/schedule_attempt_request_details_step_settings'

    schedule_attempt_request_details_step_settings:
      type: object
      description: >
        A list of key-value pairs that your step is configured to accept. Expect both standard
        step settings, and custom ones if your step supports it.
      required:
        - is_dry_run
      properties:
        is_dry_run:
          type: boolean
          description: >
            Marks whether this is a dry run. If true, you should not do any actual work.
      additionalProperties: true

    schedule_attempt_outcome:
      type: object
      required:
        - step_run_id
        - outcome
      properties:
        step_run_id:
          type: string
          format: uuid
          description: >
            The original step run ID provided.
        step_key:
          type: string
          description: >
            The original step key provided. If not provided, Punchout will try to find the best
            match to update.
        attempt_id:
          type: string
          format: uuid
          description: >
            The original run attempt ID provided. If not provided, Punchout will try to infer the
            attempt ID.
        outcome:
          $ref: '#/components/schemas/schedule_attempt_outcome_value'

    schedule_attempt_outcome_value:
      type: string
      description: >
        A description of the final outcome of the attempt. This will determine if the step could be
        marked for retry or not.
      enum:
        - SUCCESS
        - FAILED
